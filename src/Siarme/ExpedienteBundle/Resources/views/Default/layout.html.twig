{# Siarme\ExpedienteBundle\Resources\views\Default\layout.html.twig#}
{% set edit = false %}
{% if tramite.id is defined %}
    {% if tramite.id is not null %}
        {% if tramite.proceso.id is defined %}
            {% set edit = tramite.proceso | tramite_editar(app.user) %}
        {% else %}
            {% set edit = tramite | tramite_editar(app.user) %}
        {% endif %}
    {% endif %}
{% endif %}
{% if itemOferta.proceso.id is defined %}
    {% set edit = itemOferta.proceso | tramite_editar(app.user) %}
{% endif %}
{% if itemPedido.tramite.id is defined %}
    {% set edit = itemPedido.tramite | tramite_editar(app.user) %}
{% endif %}
{% if itemProceso.proceso.id is defined %}
    {% set edit = itemProceso.proceso | tramite_editar(app.user) %}
{% endif %}
{% if documento.tramite.id is defined %}
    {% set edit = documento.tramite | tramite_editar(app.user) %}
{% endif %}
{% extends '::base.html.twig' %}
{% block title %} Escritorio {% endblock %}
{% block stylesheets %}   
    <link href="{{ asset('bundles/expediente/plugins/boostrap3/css/bootstrap_cerulean.min.css') }}" type="text/css" rel="stylesheet"> 

    <link rel="stylesheet" href="{{ asset('bundles/expediente/plugins/font-awesome/css/font-awesome.min.css') }}">  

    <link href="{{ asset('bundles/expediente/plugins/datatables/jquery.dataTables.min.css')}}" type="text/css" rel="stylesheet">
    <link href="{{ asset('bundles/expediente/plugins/select2/css/select2.min.css') }}" rel="stylesheet">     
    <link href="{{ asset('bundles/expediente/plugins/dropzone/dist/dropzone.css') }}" rel="stylesheet">
    <link href="{{ asset('bundles/expediente/plugins/custom/estilos_personalizados.css') }}?v=1.1" type="text/css" rel="stylesheet"> 
{% endblock %}

{% block header %}
        {{ include('ExpedienteBundle:Default:_breadcrumb.html.twig') }}
{% endblock %}

{% block mensaje %}
 {{ include('ExpedienteBundle:Default:_mensaje.html.twig') }}
{% endblock %}
{% block footer %}
<dir class="footer">
    <a href="#inicio" id="back-to-top" class="btn btn-primary back-to-top" role="button" title="Volver al inicio">
      <span class="glyphicon glyphicon-chevron-up"></span>
    </a>
</dir>
{% endblock %}
{% block javascripts %} 
    <script src="{{ asset('bundles/expediente/plugins/jquery/jquery.min.js') }}"></script>
    <script src="{{ asset('bundles/expediente/plugins/jquery/jquery.session.js') }}"></script>
    <script src="{{ asset('bundles/expediente/plugins/boostrap3/js/bootstrap.min.js') }}"></script>         
    <script src="{{ asset('bundles/expediente/plugins/print/printArea.js') }}"></script> 
    <script src="{{ asset('bundles/expediente/plugins/dropzone/dist/dropzone.js') }}"></script>
    <script src="{{ asset('bundles/expediente/plugins/datatables/jquery.dataTables.min.js') }}"></script>
    <script>  
        var URL = "{{ app.request.getSchemeAndHttpHost()}}";
    </script>
    <script src="{{ asset('bundles/expediente/plugins/clipboard/dist/clipboard.min.js') }}"></script>
    <script src="{{ asset('bundles/tetranzselect2entity/js/select2entity.js') }}"></script>
    <script src="{{ asset('bundles/expediente/plugins/select2/js/select2.min.js') }}"></script>
    <script src="{{ asset('bundles/expediente/plugins/ckeditor/ckeditor.js') }}"></script>
    <script src="{{ asset('bundles/expediente/plugins/autosize/autosize.min.js') }}"></script>
     <script src="{{ asset('bundles/expediente/plugins/fullcalendar/index.global.min.js') }}"></script>
<script>
        $(document).ready(function() {
            
        // Inicializa primero
        autosize($('textarea'));

        // Luego, fuerza una actualización después de un breve retraso
        setTimeout(function() {
            autosize.update($('textarea'));
        }, 1);

          $('textarea').attr('autocomplete', 'off');
          // Al mostrar cualquier modal, re-aplica autosize solo a los textareas visibles
          $('.modal').on('shown.bs.modal', function () {
            autosize.update($(this).find('textarea'));
            $(this).find('textarea').attr('autocomplete', 'off');
          });

            // Muestra u oculta el botón según la posición de desplazamiento
            $(window).scroll(function(){
                    if ($(this).scrollTop() > 100) { // Muestra el botón después de desplazarse 100px
                        $('#back-to-top').fadeIn();
                    } else {
                        $('#back-to-top').fadeOut();
                    }
            });
            
            // Desplazamiento suave hacia arriba cuando se hace clic en el botón
            $('#back-to-top').click(function(){
                    $('html, body').animate({scrollTop : 0}, 800); // Duración del desplazamiento 800ms
                    return false;
            });
                
            $('.formulario-comentario').on('submit', function(event) {
                event.preventDefault(); // Evitar el envío normal del formulario
        
                var $form = $(this);
                var url = $form.data('url'); // Obtener la URL del atributo data-url
                var $enviando = $form.find('.comentario-enviando');
                var $enviado = $form.find('.comentario-enviado');
                var $error = $form.find('.comentario-error');
                var $comentario = $form.find('.comentario');
                var $textarea = $form.find('.comentario-texto');
        
                // Mostrar el indicador de "enviando"
                $enviando.show();
                $enviado.hide();
                $error.hide();
        
                $.ajax({
                    url: url,
                    method: 'POST',
                    data: $form.serialize(), // Serializar los datos del formulario
                    dataType: 'json', // Esperamos una respuesta en formato JSON
                    success: function(data) {
                        $enviando.hide();
                        if (data && data.id && data.texto) {
                            // Crear el elemento div
                            var $nuevoDivContenedor = $('<div></div>');
                            // Crear el elemento div
                            var $nuevoDiv = $('<div></div>');
                            // Crear el span para el ID y ocultarlo
                            var $idSpan = $('<span></span>').text(data.id).hide();
        
                            // Crear el span para el texto
                            var $textoSpan = $('<span></span>').text(data.texto);
        
                           // Crear el nodo de texto con el guion
                            var $separador = $('<span>&nbsp;</span>');
        
                            // Crear el enlace de acción
                            var rutaEliminar = "{{ path('comentario_eliminar', { 'id': 'id_ruta'}) }}";
                            let idParaReemplazar = "id_ruta" ;
                            let nuevoId = data.id;
                            rutaEliminar= rutaEliminar.replace(idParaReemplazar, nuevoId);
                            
                            var $accion = $('<a></a>')
                                .attr('data-href', rutaEliminar)
                                .addClass('btn-eliminar-comentario text-danger')
                                .html('<span data-toggle="tooltip" data-placement="top" title="Quitar comentario" class="glyphicon glyphicon-trash"></span>');
        
                            // Insertar los spans, el separador y la acción dentro del div
                            $nuevoDiv.append($idSpan, $textoSpan,$separador,$accion);
                            $nuevoDivContenedor.append($nuevoDiv);
                            // Obtener el elemento DOM de $comentario
                            var idComentarioElement = $comentario.get(0);
        
                            // Insertar el div creado dentro del elemento DOM de $comentario
                            if (idComentarioElement) {
                                idComentarioElement.appendChild($nuevoDivContenedor.get(0));
                            }
        
                            //$comentario.text(data.id);
                            //$omentario.text(data.id);
                            $enviado.show();
                            // Opcional: Limpiar el textarea después del éxito
                            $textarea.val('');
                        } else {
                            $error.show();
                            console.error('Respuesta JSON inválida:', data);
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        $enviando.hide();
                        $error.show();
                        console.error('Error en la petición AJAX:', textStatus, errorThrown);
                    }
                });
            });
        });

        document.addEventListener('DOMContentLoaded', () => {
            // Selecciona todos los formularios con la clase 'formulario-cantidad'
            const formularios = document.querySelectorAll('.formulario-cantidad');

            formularios.forEach(formulario => {
                const inputCantidad = formulario.querySelector('.cantidad-input');
                const url = formulario.dataset.url; // Obtiene la URL del atributo data-url

                // Elementos para mostrar los estados
                const iconoEnviando = formulario.querySelector('.enviando');
                const iconoEnviado = formulario.querySelector('.enviado');
                const iconoError = formulario.querySelector('.error');
                const iconoEscribiendo = formulario.querySelector('.escribiendo'); // Nuevo icono para "escribiendo"

                // Función para resetear todos los iconos de estado
                const resetearIconos = () => {
                    iconoEnviando.style.display = 'none';
                    iconoEnviado.style.display = 'none';
                    iconoError.style.display = 'none';
                    iconoEscribiendo.style.display = 'none'; // También ocultar el icono "escribiendo"
                };

                // Escucha el evento 'input' en el input de cantidad
                // Este evento se dispara cada vez que el valor del input cambia (mientras el usuario teclea)
                inputCantidad.addEventListener('input', () => {
                    resetearIconos(); // Oculta todos los iconos de estado previos
                    inputCantidad.style.borderColor = ''; // Elimina el borde rojo/verde

                    // Si el input no está vacío, muestra el icono "escribiendo"
                    if (inputCantidad.value.trim() !== '') {
                        iconoEscribiendo.style.display = 'inline-block';
                    }
                });

                // Escucha el evento 'change' en el input de cantidad (cuando el foco sale del input)
                inputCantidad.addEventListener('change', async (event) => {
                    const valor = parseInt(event.target.value);

                    // Oculta el icono "escribiendo" tan pronto como el cambio se complete
                    iconoEscribiendo.style.display = 'none';

                    // Resetea los otros iconos de estado antes de la nueva acción
                    iconoEnviado.style.display = 'none';
                    iconoError.style.display = 'none';

                    // Validación: debe ser un entero positivo
                    if (isNaN(valor) || valor < 0 || !Number.isInteger(valor)) {
                        inputCantidad.style.borderColor = 'red'; // Cambia el borde a rojo
                        iconoError.style.display = 'inline-block'; // Muestra el icono de error
                        return; // Detiene el envío si la validación falla
                    }

                    // Muestra el icono de "enviando"
                    iconoEnviando.style.display = 'inline-block';
                    inputCantidad.style.borderColor = ''; // Limpia cualquier borde previo antes de enviar

                    try {
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-Requested-With': 'XMLHttpRequest'
                            },
                            body: JSON.stringify({ cantidad: valor })
                        });

                        if (!response.ok) {
                            throw new Error(`Error en la petición: ${response.statusText}`);
                        }

                        const data = await response.json();

                        // Oculta el icono de "enviando"
                        iconoEnviando.style.display = 'none';

                        // Muestra el icono correspondiente según la respuesta (true/false)
                        if (data === true) {
                            iconoEnviado.style.display = 'inline-block';
                            inputCantidad.style.borderColor = 'green';
                        } else {
                            iconoError.style.display = 'inline-block';
                            inputCantidad.style.borderColor = 'red';
                        }

                    } catch (error) {
                        console.error('Error al enviar el formulario:', error);
                        resetearIconos(); // Asegura que no se muestre el "enviando" si hubo un error
                        iconoError.style.display = 'inline-block'; // Muestra el icono de error
                        inputCantidad.style.borderColor = 'red'; // Borde rojo en caso de error de red/servidor
                    }
                });
            });
        });
        
    // TAB Activo
    if ($.session.get('claseActiva')== null) {
        $.session.set('claseActiva', 'todos');
    }
    
    $(".tab-" + $.session.get('claseActiva')).addClass("active");
    $('.tab-tipoTramite  a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
      var target = $(e.target).attr("href") // activated tab
      var target = target.substring(1);
      $.session.set('claseActiva', target);
       var clase= $.session.get('claseActiva');
    });//--tab activo 
    $.fn.modal.Constructor.prototype.enforceFocus = function() {};
    <!-- $('select').select2({  allowClear:true, placeholder:""}); -->

          $('select').select2({width:'100%', allowClear:true, placeholder:"Seleccionar"});

           <!--POPOVER-->
          $('#popover-nuevo').popover('show');
          $('body').on('click', function (e) {
          $('[data-toggle=popover]').each(function () {
              // hide any open popovers when the anywhere else in the body is clicked
              if (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {
                  $(this).popover('hide');
              }
          });
      });

/** <!--MODULO EXPEDIENTE -->
$("#siarme_expedientebundle_expediente_Tramite_0_PresupuestoOficial").change(function() {
  let str = $(this).val();
  str = str.replace("$", "");
  str = str.replace(".", "");
  str = str.trim();
  $("#siarme_expedientebundle_expediente_Tramite_0_PresupuestoOficial").val(str);
            });*/

$("#siarme_expedientebundle_expediente_numeroGde").change(function() {
  let str = $(this).val();
  str = str.trim();
  $("#siarme_expedientebundle_expediente_numeroGde").val(str);
            });
/** <!-- MODULO TRAMITE -->
$("#siarme_expedientebundle_tramite_montoAdjudica").change(function() {
  let str = $(this).val();
  str = str.replace("$", "");
  str = str.replace(".", "");
  str = str.trim();
  $("#siarme_expedientebundle_tramite_montoAdjudica").val(str);
            });*/
            
  $(".currency").change(function() {
  let str = $(this).val();
  str = str.replace("$", "");
  str = str.replace("(", "");
  str = str.replace(")", "");
  str = str.replace(".", "");
  str = str.trim();
  $(".currency").val(str);
            });             
/**
 * Crea un contador de tiempo que se actualiza cada segundo y que muestra
 * cuánto falta para que expire la oferta.
 */
function muestraCuentaAtras(id, fecha) {
    var horas, minutos, segundos;
    
    var ahora = new Date();
    var fechaExpiracion = new Date(fecha.ano, fecha.mes, fecha.dia, fecha.hora, fecha.minuto, fecha.segundo);
    
    var falta = Math.floor( (fechaExpiracion.getTime() - ahora.getTime()) / 1000 );
    
    if (falta < 0) {
        cuentaAtras = 'Finalizado';
    }
    else {
        horas = Math.floor(falta/3600);
        falta = falta % 3600;
        
        minutos = Math.floor(falta/60);
        falta = falta % 60;
        
        segundos = Math.floor(falta);
        
        cuentaAtras = (horas < 10    ? '0' + horas    : horas)    + 'h '
                    + (minutos < 10  ? '0' + minutos  : minutos)  + 'm '
                    + (segundos < 10 ? '0' + segundos : segundos) + 's ';
        
        setTimeout(function() {
            muestraCuentaAtras(id, fecha);
        }, 1000);
    }
    
    document.getElementById(id).innerHTML = cuentaAtras;
}


    
$(".btn-nuevoCredito").unbind('click').click( function(){
        var $href= $(this).attr("data-href");
        
        $.ajax({
             url: URL+$href,
             type: 'GET',
             success: function(response){
             var msj= document.getElementById("modal-body-credito");
             msj.innerHTML =response;
             $('#modal-credito').modal('show');
             $("#siarme_expedientebundle_credito_monto").change(function() {
                  let str = $(this).val();
                  str = str.replace("$", "");
                  str = str.replace(".", "");
                  str = str.replace(".", "");
                  str = str.replace(".", "");
                  str = str.trim();
                  $("#siarme_expedientebundle_credito_monto").val(str);
             });
             } 
        }); 
    });
    
$(".btn-editarCredito").unbind('click').click( function(){
        var $href= $(this).attr("data-href");
        
        $.ajax({
             url: URL+$href,
             type: 'GET',
             success: function(response){
             var msj= document.getElementById("modal-body-credito");
             msj.innerHTML =response;
             $('#modal-credito').modal('show');
             $("#siarme_expedientebundle_credito_monto").change(function() {
                  let str = $(this).val();
                  str = str.replace("$", "");
                  str = str.replace(".", "");
                  str = str.replace(".", "");
                  str = str.replace(".", "");
                  str = str.trim();
                  $("#siarme_expedientebundle_credito_monto").val(str);
            });             
            } 
        }); 
    });

$("#siarme_expedientebundle_tramite_numeroComprar").change(function() {
  let str = $(this).val();
  str = str.trim();
  $("#siarme_expedientebundle_tramite_numeroComprar").val(str);
            });

  $("#siarme_expedientebundle_tramite_PresupuestoOficial").change(function() {
  let str = $(this).val();
  str = str.replace("$", "");
  str = str.replace(".", "");
  str = str.replace(".", "");
  str = str.replace(".", "");
  str = str.trim();

  $("#siarme_expedientebundle_tramite_PresupuestoOficial").val(str);
            });
            
  $(function () {
    $("#tablaTramite").DataTable({"searching": true,"lengthChange": true, "order": [[ 1, "desc" ]],"pageLength": 10,
            "language": {
                "url": "{{asset('bundles/expediente/plugins/datatables/extensions/language/Spanish.json')}}"
            },"lengthMenu": [[10, 25, 50, 100,-1], [10, 25, 50, 100, "Todo"]],
        });
  });

    $('#tablaTramite tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected');
    } );

  $(function () {
      $(".tablaSinOrdenar").DataTable({"searching": true,"ordering": false,"lengthChange": true,"pageLength": -1,
                "language": {
                    "url": "{{asset('bundles/expediente/plugins/datatables/extensions/language/Spanish.json')}}"
                },"lengthMenu": [[10, 25, 50, 100,-1], [10, 25, 50, 100, "Todo"]],
            });
  });
  
    $(function () {
        $(".tablaTramite").DataTable({"searching": true,"lengthChange": true, "order": [[ 1, "desc" ]],"pageLength": 10,
                "language": {
                    "url": "{{asset('bundles/expediente/plugins/datatables/extensions/language/Spanish.json')}}"
                },"lengthMenu": [[10, 25, 50, 100,-1], [10, 25, 50, 100, "Todo"]],
            });
    });
    
    //boton cambiar es ESTADO item tramite pedido
    $(".btn-estado-item").unbind('click').click( function(){
        let $op= confirm('¿Desea cambiar de estado?');
        if ($op) {
            if ( $(this).find('.glyphicon').hasClass("glyphicon-check")){
    
             $(this).find('.glyphicon').removeClass("glyphicon-check").addClass("glyphicon-unchecked text-warning");
             $(this).parent().parent().find('.estado').html('No válido');
    
            } else {
                $(this).find('.glyphicon').removeClass("glyphicon-unchecked text-warning").addClass("glyphicon-check");
                $(this).parent().parent().find('.estado').html('Válido');
            }
             //$(this).find('.glyphicon').toggleClass('glyphicon-unchecked','glyphicon-check');
            // $(this).parent().parent().find('.estado').html('Rectifiar');
    
                var $href= $(this).attr("data-href");
    
                //alert(URL+$
                $.ajax({
    
                     url: URL+$href,
                     type: 'POST',
                     success: function(response){
                        $(".estadoTramite").html("(Evaluación)");
                        if($('#actualizar-pagina').is(':hidden')){
                            $('#actualizar-pagina').removeClass("hidden");
                        }
                        console.log( response);
                     } 
                });
        }
    });
    
    $('.collapse').on('shown.bs.collapse', function(){
      $(this).parent().find(".glyphicon-plus").removeClass("glyphicon-plus text-info").addClass("glyphicon-minus");
        }).on('hidden.bs.collapse', function(){$(this).parent().find(".glyphicon-minus").removeClass("glyphicon-minus").addClass("glyphicon-plus text-info");
    });


    //boton eliminar item tramite pedido
    $(".btn-eliminar-item").unbind('click').click( function(){
      var $op=confirm("¿Esta seguro de Eliminar el Item?");
      if ($op==true) {
        var $href= $(this).attr("data-href");
        //alert(URL+$href);
        $(this).parent().parent().addClass("hidden");
        $.ajax({

             url: URL+$href,
             type: 'POST',
             success: function(response){
                console.log( response);

             } 
        });
      } 
      
    });

    //boton para cabiar estado de Expediente para Archivar.
    $(".btn-expediente-estado").unbind('click').click( function(){
        var $href= $(this).attr("data-href");

        if ( $(this).find('.glyphicon').hasClass("glyphicon-check")){

         $(this).find('.glyphicon').removeClass("glyphicon-check").addClass("glyphicon glyphicon-unchecked");
         $(this).find('.expedienteEstado').html('Archivar');

        } else {
            $(this).find('.glyphicon').removeClass("glyphicon-unchecked").addClass("glyphicon glyphicon-check");
                    $(this).find('.expedienteEstado').html('Archivado');

        }
        $(this).toggleClass('text-muted','text-primary');
        $(this).toggleClass('text-primary','text-muted');

        $.ajax({

             url: URL+$href,
             type: 'POST',
             success: function(response){
                console.log(response);
             } 
        });
  
    });
    
  $(function () { // "order": [[ 1, "desc" ]]
    $("#tablaItemPedido").DataTable({"searching": true,"lengthChange": true, "order": [[ 1, "asc" ]],"pageLength": -1,
            "language": {
                "url": "{{asset('bundles/expediente/plugins/datatables/extensions/language/Spanish.json')}}"
            }, "lengthMenu": [[10, 25, 50, 100,-1], [10, 25, 50, 100, "Todo"]],
        });
  });

  $(function () { // "order": [[ 1, "desc" ]]
    $(".tablaItem").DataTable({"searching": true,"lengthChange": true, "order": [[ 1, "asc" ]],"pageLength": -1,
            "language": {
                "url": "{{asset('bundles/expediente/plugins/datatables/extensions/language/Spanish.json')}}"
            }, "lengthMenu": [[10, 25, 50, 100,-1], [10, 25, 50, 100, "Todo"]],
        });
  });

  $(function () { // "order": [[ 1, "desc" ]]
    $(".tablaLicencia").DataTable({"searching": true, "lengthChange": false, "order": [[ 0, "desc" ]],"pageLength": -1,
            "language": {
                "url": "{{asset('bundles/expediente/plugins/datatables/extensions/language/Spanish.json')}}"
            }, "lengthMenu": [[10, 25, 50, 100,-1], [10, 25, 50, 100, "Todo"]],
        });
  });
  
    $('#tablaItemProceso tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected');
    } );  
    
    $(function () { // "order": [[ 1, "desc" ]]
        $("#tablaItemPonderado").DataTable({"searching": true,"lengthChange": true, "order": [[ 1, "asc" ],[ 5, "desc" ]],"pageLength": -1,
                "language": {
                    "url": "{{asset('bundles/expediente/plugins/datatables/extensions/language/Spanish.json')}}"
                }, "lengthMenu": [[10, 25, 50, 100,-1], [10, 25, 50, 100, "Todo"]],
            });
    });
    $('#tablaItemPonderado tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected');
    } );


    $('#tablaItemPedido tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected');
    } );
    
    $('#tablaItemDuplicado tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected');
    } );

  <!--MODULO DOCUMENTO -->

var claseA = document.querySelectorAll('.file-icon');
for (var i = 0; i < claseA.length; i++) {
 console.log(claseA[i].dataset.type);
 var fileType =claseA[i].dataset.type
    switch(fileType) {
      case "pdf":
         claseA[i].className = "fa fa-file-pdf-o text-danger hidden-print";
        break;
      case "xlsx": case "xls": case "csv": case "ods":
         claseA[i].className = "fa fa-file-excel-o text-success hidden-print";
        break;
      case "docx": case "dox": case "txt":
         claseA[i].className = "fa fa-file-word-o text-primary hidden-print";
        break;
      case "pptx": case "ppt":
         claseA[i].className = "fa fa-file-powerpoint-o text-danger hidden-print";
        break;
      case "zip": case "rar":
         claseA[i].className = "fa fa-file-archive-o text-muted hidden-print";
        break;
      case "jpg": case "gif": case "png":  case "jpeg":
         claseA[i].className = "fa fa-file-image-o text-primary hidden-print";
        break;
      default:
         claseA[i].className = "fa fa-file-o text-primary hidden-print";
        
    } 

}

      <!-- 3. Instantiate clipboard by passing a list of HTML elements -->
          var clipboard = new ClipboardJS('.btn');

          clipboard.on('success', function(e) {
              console.info('Action:', e.action);
              console.info('Text:', e.text);
              console.info('Trigger:', e.trigger);

             // e.clearSelection();
          });

          clipboard.on('error', function(e) {
              console.error('Action:', e.action);
              console.error('Trigger:', e.trigger);
          });


 /**   var introduction = document.getElementById('siarme_expedientebundle_comentario');
    introduction.setAttribute('contenteditable', true);

    CKEDITOR.inline('siarme_expedientebundle_comentario', {
      // Allow some non-standard markup that we used in the introduction.
      // Show toolbar on startup (optional).
      startupFocus: true
    });*/


        $(document).ready(function(){ //popTitle:"Documento"
          var options = {mode:"popup", popHt: 500,   popWd: 400, popX: 100,   popY: 100, popTitle:"", popClose: false, strict: undefined};
            $("#printer").click(function(){
            $("div.print").printArea(options); 
            });      
        });  

 $(function (){
    $("#alerta").unbind('click').click( function(){

        var $href= "{{ path('compartir_visto') }}";
        //alert(URL+$href);
        // $(this).parent().parent().addClass("hidden");
        $.ajax({
             url: URL+$href,
             type: 'GET',
             success: function(response){
                console.log( response);
             } 
        });
      
    });
    

  });
{#/**  Esta duncion permite cargar cada 3 segundos un controlador bucando por 'id' la seccio donde cargar el html 
var myVar = setInterval(myTimer, 1000);

function myTimer() {

  $("#myId").load( "{{ path('datoat_turno_new' , { 'id': expediente.datoAt.id } ) }}");
} */#}

var myVar = setInterval(myTimer, 70000);

function myTimer() {

  $("#alerta").load( "{{ path('compartir_alerta') }}");
}

/**
    var password = document.getElementById("password")
        , confirm_password = document.getElementById("confirm_password"), password_current = document.getElementById("passwordCurrent")
        , password_user = document.getElementById("passwordUser");

      function validatePassword(){
        if(password.value != confirm_password.value) {
          confirm_password.setCustomValidity("La contraseña no coincide");
        } else {
          confirm_password.setCustomValidity('');
        }
      }

      function validatePasswordUser(){
        if(password_user.value != password_current.value) {
          password_user.setCustomValidity("Ingrese la contraseña anterior");
        } else {
          password_user.setCustomValidity('');
        }
      }
      password_user.onchange = validatePasswordUser;
      password_user.onkeyup = validatePasswordUser;
      password.onchange = validatePassword;
      confirm_password.onkeyup = validatePassword;              
*/
  </script>
   <script>
        $(document).ready(function(){
                $('[data-toggle="tooltip"]').tooltip(); 

            });
            
    Dropzone.autoDiscover = false;            
    document.addEventListener("DOMContentLoaded", function () {
        const dropzoneElement = document.querySelector(".dropzone");
    
        if (dropzoneElement) {
            new Dropzone(dropzoneElement, { 
                init: function() {
                    this.on("queuecomplete", function () {
                        location.reload();
                    });
                }
            });
        }
    });
            
   </script>
   <script> 
   $(function() {
    $('a[data-toggle="tab"]').on('click', function(e) {
        window.localStorage.setItem('activeTab', $(e.target).attr('href'));
    });
    var activeTab = window.localStorage.getItem('activeTab');
    if (activeTab) {
        $('#myTab a[href="' + activeTab + '"]').tab('show');
        window.localStorage.removeItem("activeTab");
    }
});

    $(function (){
        $(document).on('click', ".btn-eliminar-comentario", function(){
            var $op=confirm("Esta seguro de Eliminar ");
            if ($op==true) {
                var $href= $(this).attr("data-href");
                //alert(URL+$href);
                $(this).parent().parent().hide(); // O quizás $(this).closest('div').hide(); dependiendo de tu estructura HTML
                $.ajax({
                    url: URL+$href,
                    type: 'GET',
                    success: function(response){
                        console.log( response);
                    }
                });
            }
        });
    });
  
  $(function (){
    $(".btn-enviar-mensaje").unbind('click').click( function(){
     // var $op=confirm("Esta seguro de enviar mensaje ");
    //  if ($op==true) {
        var $numTel= $(this).attr("data-tel");
        //alert($href);

        var message =  $(this).attr("data-msj");;
        var number = $numTel;
        
        var url = "https://web.whatsapp.com/send?phone=54"+encodeURIComponent(number)+"&text="+encodeURIComponent(message)+'&source=&data=';
        window.open(url);
        return false;
      
    });

  });

/**CUANDO SE EDITA UN EXPEDIENTE Y SE BUSCA UN AGENTE */

    $("#siarme_expedientebundle_expediente_agente").select2({
        placeholder: 'APELLIDO Y NOMBRE O DNI',
        minimumInputLength: 3,
        cache: true,
        ajax: {
           url: "{{ path('agente_search') }}",
           dataType: 'json',            
           delay: 5000,
           data: function (params) {
              return {
                      q: params.term // search term
                     };
           },
           processResults: function (data) {
             return {
                      results: $.map(data, function(obj) {
                         return { id: obj.id, text: obj.text };
                      })
                    };
           },
           
        },

    });


  </script>

{% endblock  %}