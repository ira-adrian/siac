{# Siarme/AusentismoBundle/Resources/views/Agente/index.html.twig #}
{% extends 'ExpedienteBundle:Default:layout.html.twig' %}

{% block title %} {{ tramite.tipoTramite }} {{ tramite.numeroTramite }} {% endblock %}
{% block contenido %}
<div class="container"> 
 {% set pedidos1 = tramite.expediente | tramite_por_expediente_slug("tramite_pedido") %}
{% if pedidos1 | length > 1 %}
<nav aria-label="Page navigation">
  <ul class="pager"  style="margin-bottom:0px; margin-top:5px;">
    {% for tramite1 in pedidos1 %}
        {% if tramite1.id == tramite.id %}
            <li class="active"><span  class='{{ tramite1.tipoTramite.glyphicon}}'></span>{{tramite1.tipoTramite}} N° {{tramite1.numeroTramite }}</strong></li>
        {% else %} 
                <li data-toggle="tooltip" data-placement="top" title="{{tramite1.organismoOrigen}}"><a href="{{ path('tramite_show', { 'id': tramite1.id  }) }}"><span  class='{{ tramite1.tipoTramite.glyphicon}}'></span>{{tramite1.tipoTramite}} N° {{tramite1.numeroTramite }}</a></li> 
        {% endif %}
    {% endfor %}
  </ul>
</nav>
{% endif %}
<div class="nav nav-pills hidden-print"> 
      <li role="presentation" class="disabled"><a href="#">Menu</a></li>
{#{% if ( app.user.departamentoRm == tramite.departamentoRm ) and (( tramite.expediente | default(null) | movimiento_estado(app.user)) or tramite.expediente.id is not defined) %} #}

    <li role="presentation"  class="dropdown overflow" >
            <a class="dropdown-toggle" href="#" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-pencil"></span> Modificar <span class="caret"></span></a>
            <div class="dropdown-menu" style="width: 400px;" aria-labelledby="dropdownMenuLink">
              <div class="list-group-item">
                    {{ render(controller('ExpedienteBundle:Tramite:edit', {'id': tramite.id  }))}}
              </div>
            </div>
    </li> 
    <li role="presentation" data-toggle="tooltip" data-placement="top" title='Eliminar el {{ tramite.tipoTramite }}  {{ tramite.numeroTramite }}' >
                <a  role="button" onclick= "return confirm('¿Desea ELIMINAR el {{ tramite.tipoTramite }}  {{ tramite.numeroTramite }}?');" href="{{ path('tramite_eliminar' , { 'id': tramite.id }) }}"> <span class="glyphicon glyphicon-trash text-danger"> </span> Eliminar</a>
    </li>  
{#
       {% if (movimientoPendiente is defined) and (movimientoPendiente is not empty) %}
          {% if   tramite.expediente | length <= 0 %}
         <li role="presentation" data-toggle="tooltip" data-placement="top" title='Añadir este {{ tramite.tipoTramite }} al expediente iniciado para consolidar'>
            <a  role="button" href="{{ path('tramite_expediente_agregar' , { 'tramite_id': tramite.id }) }}"> <span class="glyphicon glyphicon-folder-open text-warning" onclick= "return confirm('¿Desea consolidar?');" ></span> Añadir</a>
        </li>
       {% endif %}
      {% elseif (tramite.expediente | length <= 0)  %}
        <li role="presentation" data-toggle="tooltip" data-placement="top" title='Añade este {{ tramite.tipoTramite }} a un nuevo expediente'>
          <a  role="button" href="{{ path('movimiento_expediente_new' , { 'tramite_id': tramite.id }) }}"><span class="glyphicon glyphicon-folder-open" onclick= "return confirm('¿Desea iniciar una Solicitud?');" ></span> Añadir PEDIDO</a> 
         </li>
      {% endif %}
#}

         {#
         <li role="presentation" class="dropdown" data-toggle="tooltip" data-placement="bottom" title='Comparte y Notifica a un usuario acerca este PEDIDO'>
                    <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><span class="glyphicon glyphicon-share"></span> Notificar<span class="caret"></span></a>             
                     <ul class="dropdown-menu">
                       <li class="dropdown-header" style="width:40em">
                        {- El tipo puede ser ['EX','DOC','AG','MSJ'] corresponde con las entidades Expediente, Documento, Agente, Mensaje -}
                         {{ render(controller('DocumentoBundle:Compartir:new', { 'tipoid': tramite.id, 'tipo': constant('TIPO_ENTIDAD', tramite)})) }}
                       </li>
                     </ul>
            </li>
        #}
    <!-- Menu DERECHO *** IMPRIMIR - COPIAR -->
    <div class="pull-right">
            <li  role="presentation">

            <a href="https://docs.google.com/spreadsheets/d/1evDkuVFNirUdLmjbtP_0FPM9w8Ty6XPccaxQ7ZiLn-8/edit?usp=sharing" target="_blank"> <span class="fa fa-file-excel-o text-success" ></span> Montos BAPIN </a>&nbsp;&nbsp;
              <a id="printer"  value="Imprimir" role="button"><!-- Printer-imprime el texto de clase="print" -->
                <span class="glyphicon glyphicon-print"></span> Imprimir</a>

                <a class="btn" data-clipboard-target="#copy"><!-- clipboard-copiar texto de id="copy" -->
                  <span class="glyphicon glyphicon-copy"></span>Copiar</a>
            </li>
    </div>
</div>
{% set year = 'now' | date('Y')%}
<!-- copiar - imprimir-->
<div id="copy" class="panel panel-warning print">
    <style type="text/css" media="print">
        @media print {
            a[href]:after {
                content: none !important;
            }
        }
    </style> 
      <!-- Default panel contents -->
      <div class="panel-heading">
          &nbsp;&nbsp;<span class='{{ tramite.tipoTramite.glyphicon}}'></span> {{ tramite.tipoTramite }} {{ tramite.numeroTramite }} | {% if tramite.fechaDestino %} {{ tramite.fechaDestino|date('d-m-Y') }}  {{ tramite.fechaDestino| long_time }} {% endif %}
          <span class="pull-right">{{ include('ExpedienteBundle:Tramite:_estado_etiqueta.html.twig') }}</span>
      </div>

     <div class="panel-body">
            <dl class="list-group-item-heading text-center" role="tab" id="headingTwo">
                <dt> Nota de PLANIFICACION del SAF </dt>
                <dd >{{ tramite.ccoo | default('NO-'~ year ~ '-n/d')}}</dd>
                <dt>CCOO Respuesta</dt>
                <dd>{{tramite.numeroNota | default("-")}}</dd>
                <dt>Trimestre</dt>
                <dd>  {{ tramite.trimestre }}° Trimestre</dd>
                 <dt>Unidad Ejecutora</dt>
                 <dd>
                     SAF N° {{ tramite.organismoOrigen.saf.numeroSaf | default("N/D") }} - {{ tramite.organismoOrigen.codigoGde | default("N/D") }} - {{ tramite.organismoOrigen.organismo | default("N/D") }}  
                  </dd>

                  <dt>Presupuesto Oficial </dt>
                  <dd> 
                    {% if (tramite.PresupuestoOficial | number_format(2, ',', '.') != tramite.presupuestoPlanificado | number_format(2, ',', '.') ) and tramite.documento | length > 0  %} <span class="glyphicon glyphicon-info-sign text-warning"  data-toggle="tooltip" data-placement="bottom" title='Verifique el Presupuesto Estimado, el total por rubro PLANIFICADO es $ {{ tramite.presupuestoPlanificado  | number_format(2, ',', '.')  }}' ></span> {% endif %}
                        
                    {{tramite.moneda}} ${{ tramite.PresupuestoOficial | number_format(2, ',', '.')  }} <br />
                    ( {{ numero_a_letras(tramite.PresupuestoOficial,2, tramite.moneda) }} ) <br />
                 </dd>
                    
                <div class="hidden-print">
                <dt>Tarea&nbsp;&nbsp; 
                    {% if ( app.user.departamentoRm.slug == "planificacion") %}
                        <br>
                        {% set mitramite = tramite_usuario(app.user, tramite) %}
                            {% if mitramite is empty %}
                                <a  href="{{ path('adquirir_tarea_new', { 'id': tramite.id }) }}" class="btn btn-sm btn-primary">Adquirir PLANIFICACION</a>
                            {% endif %} 
                   {% endif %}
                </dt>
                <dd>
                    {% set tareas = tramite.tarea %}
                    <table class="table table-hover">
                            <tbody> 
                              {% for tarea in tareas %}
                                    {% set tramite = tarea.tramite %}
                                    {{ include('ExpedienteBundle:Tarea:_tbody_completo.html.twig') }}      
                             {% endfor %}
                            </tbody>
                    </table>
                </dd>
                <dd >
                    {{ render(controller('DocumentoBundle:Compartir:index', { 'tipoid': tramite.id, 'tipo': constant('TIPO_ENTIDAD', tramite) } )) }} 
                </dd>
                </div>
            </dl>           
 {# ---- PARA HABILITAR ----------
            {% if tramite.estadoTramite.porcentaje < 100 %}
                    <div class="progress progress-striped active" style="margin:0px;">
                          <div class="progress-bar" role="progressbar"
                          aria-valuenow="{{tramite.estadoTramite.porcentaje}}" aria-valuemin="0" aria-valuemax="100"
                          style="width: {{tramite.estadoTramite.porcentaje}}%">
                          <span class="sr-only">{{tramite.estadoTramite.porcentaje}}% completado</span>
                          </div>
                    </div>
             {% else %}
                    <div class="progress progress-striped" style="margin:0px;">
                      <div class="progress-bar progress-bar-success" role="progressbar"
                           aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"
                           style="width: 100%">
                        <span class="sr-only">100% completado (éxito)</span>
                      </div>
                    </div>
            {% endif %}
#}
   </div>


<!-- Large modal -->
<div id="modal-nuevo-rubro"class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
<div class="modal-dialog " role="document">
  <div class="modal-content">
     <div class="modal-header text-center">
             <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> 
     </div><!-- /.header -->
         <div id="modal-body-nuevo-rubro" class="modal-body">
        </div><!-- /.body -->
    <!--    <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Cerrar</button> 
     </div> /.footer -->
  </div><!-- /.modal-content -->
</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

{{ include('ExpedienteBundle:'~ tramite.tipoTramite.slug ~':_panel_body.html.twig') }}
{#    {{ render(controller('ExpedienteBundle:Expediente:modalExpedienteNew', {'tramite_id': tramite.id}))}}#}
</div>

 {{ render(controller('ExpedienteBundle:Comentario:index',
            { 'tipoid': tramite.id, 'tipo': constant('TIPO_ENTIDAD', tramite) }
        )) }}
 {{ render(controller('ExpedienteBundle:Comentario:new',
            { 'tipoid': tramite.id, 'tipo': constant('TIPO_ENTIDAD', tramite) }
        )) }}
</div>
{% endblock %}

{% block javascripts %} 
{{ parent() }}
<script>
$(".btn-nuevo-rubro").unbind('click').click( function(){
        var $href= $(this).attr("data-href");
        $.ajax({
             url: URL+$href,
             type: 'POST',
             success: function(response){
             var msj= document.getElementById("modal-body-nuevo-rubro");
             msj.innerHTML =response;
             $('#modal-nuevo-rubro').modal('show');
             $("#siarme_expedientebundle_planificacion_importe").change(function() {
              let str = $(this).val();
              str = str.replace("$", "");
              str = str.replace(".", "");
              str = str.replace(".", "");
              str = str.replace(".", "");
              str = str.trim();
              $(this).val(str);
            });

             } 
        }); 
    });
$("#siarme_expedientebundle_tramite_PresupuestoOficial").change(function() {
  let str = $(this).val();
  str = str.replace("$", "");
  str = str.replace(".", "");
  str = str.replace(".", "");
  str = str.replace(".", "");
  str = str.trim();
  $("#siarme_expedientebundle_tramite_PresupuestoOficial").val(str);
            });

    $(".btn-concentra").unbind('click').click( function(){
       var $href= $(this).attr("data-href");
       var $etiqueta= $(this).attr("data-etiqueta");
       //$("#etiqueta-concentra").html($etiqueta);
        $(this).parent().parent().parent().find('.etiqueta-concentra').html($etiqueta);
        //alert(URL+$
        $.ajax({

             url: URL+$href,
             type: 'POST',
             success: function(response){
                console.log( response);

             } 
        });
    });

</script>
{% endblock  %}
